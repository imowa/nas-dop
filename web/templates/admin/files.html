{{define "admin/files"}}<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Files</title>
  <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
<h1>Files</h1>

<!-- Breadcrumbs -->
<nav>
{{range .Breadcrumbs}}
  <a href="/files{{.Path}}">{{.Name}}</a> /
{{end}}
</nav>

<!-- Upload Form -->
<form method="post" action="/files/upload" enctype="multipart/form-data">
  <input type="hidden" name="path" value="{{.Path}}">
  <label for="upload-files">Choose files:</label>
  <input id="upload-files" type="file" name="files" multiple>
  <button type="submit">Upload</button>
</form>

<!-- Create Folder Form -->
<form method="post" action="/files/mkdir">
  <input type="hidden" name="path" value="{{.Path}}">
  <label for="folder-name">Folder name:</label>
  <input id="folder-name" name="name" type="text" placeholder="New folder name" autocomplete="off" required>
  <button type="submit">Create Folder</button>
</form>

<!-- File List -->
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Size</th>
      <th>Modified</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
  {{range .Files}}
    <tr>
      <td>
        {{if .IsDir}}
          <a href="/files{{$.Path}}/{{.Name}}">üìÅ {{.Name}}</a>
        {{else}}
          {{$ext := .Ext}}
          {{if or (eq $ext ".jpg") (eq $ext ".jpeg") (eq $ext ".png") (eq $ext ".gif") (eq $ext ".webp")}}
            <img src="/files/thumb{{$.Path}}/{{.Name}}" alt="{{.Name}}" style="max-width:60px;max-height:60px;vertical-align:middle;margin-right:8px;border-radius:4px;">
            üñºÔ∏è {{.Name}}
          {{else if or (eq $ext ".pdf")}}
            üìï {{.Name}}
          {{else if or (eq $ext ".zip") (eq $ext ".tar") (eq $ext ".gz") (eq $ext ".rar")}}
            üì¶ {{.Name}}
          {{else if or (eq $ext ".mp4") (eq $ext ".avi") (eq $ext ".mov") (eq $ext ".mkv")}}
            üìπ {{.Name}}
          {{else if or (eq $ext ".mp3") (eq $ext ".wav") (eq $ext ".flac") (eq $ext ".m4a")}}
            üéµ {{.Name}}
          {{else if or (eq $ext ".doc") (eq $ext ".docx") (eq $ext ".txt") (eq $ext ".md")}}
            üìù {{.Name}}
          {{else}}
            üìÑ {{.Name}}
          {{end}}
        {{end}}
      </td>
      <td>{{if not .IsDir}}{{formatBytes .Size}}{{end}}</td>
      <td>{{.ModTime.Format "2006-01-02 15:04"}}</td>
      <td>
        {{if not .IsDir}}
          <a href="/files/download{{$.Path}}/{{.Name}}">Download</a>
        {{end}}
        <a href="/share/new?path={{$.Path}}/{{.Name}}">Share</a>
        <button type="button" class="rename-btn" data-path="{{$.Path}}/{{.Name}}" data-name="{{.Name}}">Rename</button>
        <form method="post" action="/files/delete" style="display:inline;">
          <input type="hidden" name="path" value="{{$.Path}}/{{.Name}}">
          <button type="submit" onclick="return confirm('Delete {{.Name}}?')">Delete</button>
        </form>
      </td>
    </tr>
  {{end}}
  </tbody>
</table>

<p>
  <a href="/shares">Manage Shares</a> |
  <a href="/logout">Logout</a>
</p>

<!-- Rename Modal -->
<div id="renameModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;">
  <div style="background:white;padding:2rem;border-radius:8px;max-width:400px;width:90%;">
    <h2 style="margin-top:0;">Rename File</h2>
    <form id="renameForm" method="post" action="/files/rename">
      <input type="hidden" name="path" id="renamePath">
      <label for="renameInput">New name:</label>
      <input type="text" name="newName" id="renameInput" placeholder="New name" autocomplete="off" required style="width:100%;margin-bottom:1rem;">
      <div style="display:flex;gap:0.5rem;justify-content:flex-end;">
        <button type="button" id="cancelRename" style="background:#6c757d;">Cancel</button>
        <button type="submit">Rename</button>
      </div>
    </form>
  </div>
</div>

<script>
// Rename functionality
const modal = document.getElementById('renameModal');
const form = document.getElementById('renameForm');
const pathInput = document.getElementById('renamePath');
const nameInput = document.getElementById('renameInput');

document.querySelectorAll('.rename-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const path = btn.dataset.path;
    const name = btn.dataset.name;
    pathInput.value = path;
    nameInput.value = name;
    modal.style.display = 'flex';
    nameInput.focus();
    nameInput.select();
  });
});

document.getElementById('cancelRename').addEventListener('click', () => {
  modal.style.display = 'none';
});

modal.addEventListener('click', (e) => {
  if (e.target === modal) {
    modal.style.display = 'none';
  }
});
</script>
</body>
</html>{{end}}
